<html>
    <head>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
            <!-- Latest compiled and minified CSS -->
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

            <script>
                var API_URL = "http://localhost:8887/";
                var previousResult = "";
                function doPoll(){
                    var mac = $("#mac").val();
                    //00:d3:30:9b:98:00
                    $.ajax(API_URL+'?mac='+mac, 
                    {
                        dataType: 'json', // type of response data
                        timeout: 500,     // timeout milliseconds
                        success: function (data,status,xhr) {   // success callback function
                            console.log(data);
                            if(JSON.stringify(data) != "{}" && JSON.stringify(data) != previousResult){
                                try{
                                    previousResult = JSON.stringify(data);
                                    updateUserDetails(data);
                                    var row = getRow(data);
                                    //$('p').append(data.firstName + ' ' + data.middleName + ' ' + data.lastName);
                                    $(row).prependTo("table > tbody");
                                }catch(e){
                                    console.log("error while reading data");
                                }

                            }
                        },
                        error: function (jqXhr, textStatus, errorMessage) { // error callback 
                            //$('p').append('Error: ' + errorMessage);
                            console.error("error");
                        }
                    });
                    setTimeout(doPoll,2000);
                }

                function getRow(data){
                    var row = "<tr>";
                    row += "<td>"+data.deviceLocationUpdate.visitId+"</td>";
                    row += "<td>"+data.deviceLocationUpdate.location.locationId+"</td>";
                    row += "<td>"+data.deviceLocationUpdate.location.name+"</td>";
                    row += "<td>"+data.deviceLocationUpdate.xPos+"</td>";
                    row += "<td>"+data.deviceLocationUpdate.yPos+"</td>";
                    row += "<td>"+data.deviceLocationUpdate.latitude+"</td>";
                    row += "<td>"+data.deviceLocationUpdate.longitude+"</td>";
                    row += "<td>"+data.deviceLocationUpdate.ssid+"</td>";
                    row += "<td>"+data.deviceLocationUpdate.location.inferredLocationTypes[0]+"</td>";
                    row += "</tr>";
                    return row;
                }

                function updateUserDetails(data){
                    $("#userDetail, #locationDetail").show();
                    $("#firstName").text(data.deviceLocationUpdate.device.firstName);
                    $("#lastName").text(data.deviceLocationUpdate.device.lastName);
                    $("#mail").text(data.deviceLocationUpdate.device.email);
                    $("#phone").text(data.deviceLocationUpdate.device.mobile);
                    $("#gender").text(data.deviceLocationUpdate.device.gender);
                }
            </script>
            <style>
            #userDetail, #locationDetail{
                display: none;
            }
            </style>
    </head>
    <body>


<div class="container" style="margin: 20px auto;">

        <h2>Detect And Locate</h2>     
        <div class="row">
    
                <div class="col"><input type="text" id="mac" placeholder="client mac" value="00:e0:ad:50:26:00"></div>
                <div class="col"><input type="button" value="Detect and Locate" onclick="doPoll()"></div>
        </div>

    <div class="row">
        
        <div class="container" id="userDetail" style="margin-top: 10px">
            <div class="row">
                    <div class="col">First Name</div>
                    <div class="col" id="firstName"></div>
                    <div class="col">Mail</div>
                    <div class="col" id="mail"></div>
            </div>
            <div class="row">
                    <div class="col">Last Name</div>
                    <div class="col" id="lastName"></div>
                    <div class="col">Phone</div>
                    <div class="col" id="phone"></div>
            </div>
            <div class="row">
                    <div class="col">Gender</div>
                    <div class="col" id="gender"></div>
                    <div class="col"></div>
                    <div class="col"></div>
            </div>
        </div>  
        <div class="container"  id="locationDetail" style="margin-top: 10px">
            <table class="table">
            <thead>
                <tr>
                <th>visitId</th>
                <th>locationId</th>
                <th>location name</th>
                <th>x pos</th>
                <th>y pos</th>
                <th>longitude</th>
                <th>latitude</th>
                <th>ssid</th>
                <th>location type</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
            </table>
        </div> 
      </div>
      </div>
    </body>
</html>